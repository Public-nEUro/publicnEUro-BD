<h1>Datasets</h1>
<p-table [value]="datasets">
    <ng-template pTemplate="header">
        <tr>
            <th>Name</th>
            <th>Accessibility</th>
            <th>DUA</th>
            <th>DUA approval</th>
            <th>SCC</th>
            <th>SCC approval</th>
            <th>DELPHI share link</th>
            <th></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-dataset>
        <tr *ngIf="editingDataset !== dataset">
            <td>{{ dataset.name }}</td>
            <td>{{ dataset.accessibility }}</td>
            <td>
                <p-button
                    *ngIf="dataset.dua_file_name !== null && dataset.dua_file_data !== null"
                    (click)="downloadDua(dataset)"
                    >{{ dataset.dua_file_name }}</p-button
                >
            </td>
            <td>{{ dataset.dua_approval_type }}</td>
            <td>
                <p-button *ngIf="dataset.scc_id !== null" (click)="downloadScc(dataset)">{{
                    getSccTitle.bind(this)(dataset.scc_id)
                }}</p-button>
            </td>
            <td>{{ dataset.scc_approval_type }}</td>
            <td>
                <a href="{{ dataset.delphi_share_url }}" target="_blank">{{ dataset.delphi_share_url }}</a>
            </td>
            <td><p-button label="Edit" (onClick)="edit(dataset)"></p-button></td>
        </tr>
        <tr *ngIf="editingDataset !== undefined && editingDataset === dataset">
            <td>{{ dataset.name }}</td>
            <td>
                <mat-form-field appearance="outline">
                    <mat-label>Accessibility</mat-label>
                    <input
                        #accessibilityInput
                        matInput
                        type="text"
                        pInputText
                        [matAutocomplete]="accessibilityAuto"
                        (input)="onAccessibilityChange(accessibilityInput.value)"
                        [(ngModel)]="editingDataset.accessibility"
                    />
                    <mat-autocomplete #accessibilityAuto="matAutocomplete">
                        <mat-option *ngFor="let accessibility of filteredAccessibilities" [value]="accessibility">
                            {{ accessibility }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </td>
            <td>
                <input type="file" pInputText (change)="onDuaFileSelected($event)" class="file-input" />
            </td>
            <td>
                <mat-form-field appearance="outline">
                    <mat-label>DUA approval</mat-label>
                    <input
                        #duaApprovalInput
                        matInput
                        type="text"
                        pInputText
                        [matAutocomplete]="duaApprovalAuto"
                        (input)="onDuaApprovalChange(duaApprovalInput.value)"
                        [(ngModel)]="editingDataset.dua_approval_type"
                    />
                    <mat-autocomplete #duaApprovalAuto="matAutocomplete">
                        <mat-option *ngFor="let duaApproval of filteredDuaApprovalTypes" [value]="duaApproval">
                            {{ duaApproval }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </td>
            <td>
                <mat-form-field appearance="outline">
                    <mat-label>SCC</mat-label>
                    <input
                        #sccInput
                        matInput
                        type="text"
                        pInputText
                        [matAutocomplete]="sccAuto"
                        (input)="onSccChange(sccInput.value)"
                        [(ngModel)]="editingDataset.scc_id"
                    />
                    <mat-autocomplete #sccAuto="matAutocomplete" [displayWith]="getSccTitle.bind(this)">
                        <mat-option *ngFor="let scc of filteredSccs" [value]="scc.id">
                            {{ scc.title }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </td>
            <td>
                <mat-form-field appearance="outline">
                    <mat-label>SCC approval</mat-label>
                    <input
                        #sccApprovalInput
                        matInput
                        type="text"
                        pInputText
                        [matAutocomplete]="sccApprovalAuto"
                        (input)="onSccApprovalChange(sccApprovalInput.value)"
                        [(ngModel)]="editingDataset.scc_approval_type"
                    />
                    <mat-autocomplete #sccApprovalAuto="matAutocomplete">
                        <mat-option *ngFor="let sccApproval of filteredSccApprovalTypes" [value]="sccApproval">
                            {{ sccApproval }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </td>
            <td>
                <mat-form-field appearance="outline">
                    <mat-label>DELPHI share link</mat-label>
                    <input matInput type="text" pInputText [(ngModel)]="dataset.delphi_share_url" />
                </mat-form-field>
            </td>
            <td><p-button label="Save" (onClick)="save(dataset)"></p-button></td>
        </tr>
    </ng-template>
</p-table>
